<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corazones Matemáticos en Cascada</title>
    <!-- Incluyendo una fuente agradable (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <style>
        /* Estilos generales */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000; /* Fondo negro como en el script de turtle */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }

        /* Contenedor principal para centrar todo */
        .container {
            position: relative;
            width: 95vw;
            height: 95vh;
            max-width: 900px;
            max-height: 900px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #111; /* Un fondo ligeramente más claro para el contenedor */
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* El canvas donde se dibujará */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            transition: opacity 0.5s ease-in-out;
        }

        /* Título */
        #title {
            position: absolute;
            top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 8px rgba(0, 0, 0, 1);
            transition: opacity 0.5s ease-in-out;
        }
        
        /* Contenedor para el poema */
        #poem-container {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 80%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease-in-out;
        }

        #poem-container.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #poem {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: #fff;
            text-align: center;
            white-space: pre-wrap;
            margin-bottom: 20px;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">Corazones en Cascada</h1>
        <canvas id="heartCanvas"></canvas>
        <div id="poem-container">
            <p id="poem"></p>
        </div>
    </div>

    <script>
        // --- LÓGICA DE JAVASCRIPT ---

        const canvas = document.getElementById('heartCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.querySelector('.container');
        const titleEl = document.getElementById('title');
        const poemContainerEl = document.getElementById('poem-container');
        const poemEl = document.getElementById('poem');
        
        let animationFrameId;
        let currentHeartIndex = 1; 
        let currentPointIndex = 0; 
        let poemFeatureStarted = false;

        const TOTAL_HEARTS = 12;
        const POINTS_PER_HEART = 100;

        // --- Poema predefinido ---
        const finalPoem = `Tus ojos de café tras el cristal,\nson mi primer sorbo, mi ritual.\nCon solo una mirada, me haces soñar,\ny mi mundo entero empieza a brillar.`;

        // --- Funciones de la animación del corazón ---
        function heartEquation(n) {
            const x = 16 * Math.pow(Math.sin(n), 3);
            const y = 13 * Math.cos(n) - 5 * Math.cos(2 * n) - 2 * Math.cos(3 * n) - Math.cos(4 * n);
            return { x, y };
        }

        function drawFullHeart(size) {
            ctx.beginPath();
            ctx.strokeStyle = "red";
            ctx.lineWidth = 1;
            for (let n = 0; n <= POINTS_PER_HEART; n += 2) {
                const angle = n / 10;
                const { x, y } = heartEquation(angle);
                const finalX = x * size;
                const finalY = y * size;
                if (n === 0) ctx.moveTo(finalX, finalY);
                else ctx.lineTo(finalX, finalY);
            }
            ctx.stroke();
        }

        function drawCurrentHeart() {
             if (currentHeartIndex >= TOTAL_HEARTS) return;
            ctx.beginPath();
            ctx.strokeStyle = "red";
            ctx.lineWidth = 1;
            for (let n = 0; n <= currentPointIndex; n += 2) {
                const angle = n / 10;
                const { x, y } = heartEquation(angle);
                const finalX = x * currentHeartIndex;
                const finalY = y * currentHeartIndex;
                if (n === 0) ctx.moveTo(finalX, finalY);
                else ctx.lineTo(finalX, finalY);
            }
            ctx.stroke();
        }

        function animate() {
            const dpr = window.devicePixelRatio || 1;
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            const width = rect.width;
            const height = rect.height;
            ctx.clearRect(0, 0, width, height);
            
            const scale = Math.min(width, height) / 2 / (16 * TOTAL_HEARTS) * 2;
            ctx.translate(width / 2, height / 2.2);
            ctx.scale(scale, -scale); 

            for (let i = 1; i < currentHeartIndex; i++) {
                drawFullHeart(i);
            }
            drawCurrentHeart();
            
            currentPointIndex += 2;
            if (currentPointIndex > POINTS_PER_HEART) {
                currentPointIndex = 0;
                currentHeartIndex++;
            }

            if (currentHeartIndex === TOTAL_HEARTS - 1 && !poemFeatureStarted) {
                startPoemFeature();
            }

            if (currentHeartIndex < TOTAL_HEARTS) {
                animationFrameId = requestAnimationFrame(animate);
            } else {
                 drawFullHeart(TOTAL_HEARTS - 1);
            }
        }
        
        function startPoemFeature() {
            if (poemFeatureStarted) return;
            poemFeatureStarted = true;

            titleEl.style.opacity = '0';
            canvas.style.opacity = '0.2'; // Atenuar el fondo
            poemEl.textContent = finalPoem;
            poemContainerEl.classList.add('visible');
        }
        
        // --- Inicialización ---
        function setup() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            poemFeatureStarted = false;
            currentHeartIndex = 1;
            currentPointIndex = 0;
            animate();
        }

        window.addEventListener('resize', setup);
        setup();
    </script>
</body>
</html>
